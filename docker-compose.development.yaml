name: server-development

services:
  roomba:
    image: ventus218/domoticasw-roomba
    # Setting network_mode to "host" let's the container access the host network
    # and is fundamental to let the device send updates to the host.
    # Another way would be to run the server inside a container on the same virtual
    # network as the device but this would make development/debuggin much harder.
    # This feature must be enabled in Docker Desktop under Settings -> Resources ->
    # Network -> Enable host networking
    # This option does not allow to publish a different port than the one exposed
    # by the container and so it should provide a way to customize that.
    network_mode: host
    environment:
      - PORT=8085

  music-player:
    image: corradostortini2/domoticasw-music-player
    network_mode: host
    environment:
      MUSICS: "Back in Black-255,Must Have Been the Wind-243,Eye of the Tiger-246,Don't Stop Me Now-209,INVISIBLE-191"
      PORT: 8086
  
  light-sensor:
    image: corradostortini2/domoticasw-light-sensor
    network_mode: host
    environment:
      PORT: 8087

  presence-sensor:
    image: ventus218/domoticasw-boolean-sensor
    network_mode: host
    environment:
      ID: presence-sensor
      TARGET_CONDITION: Presence
      CONDITION_PROBABILITY: 33
      CONDITION_TEST_PERIOD_MS: 5000
      PORT: 8088

  rain-sensor:
    image: ventus218/domoticasw-boolean-sensor
    network_mode: host
    environment:
      ID: rain-sensor
      TARGET_CONDITION: Rain
      CONDITION_PROBABILITY: 25
      CONDITION_TEST_PERIOD_MS: 5000
      PORT: 8089
  
  washing-machine:
    image: marcoraggio/domoticasw-washing-machine:latest
    network_mode: host
    environment:
      PORT: 8091
  
  smart-window:
    image: marcoraggio/domoticasw-window:latest
    network_mode: host
    environment:
      PORT: 8092

  mongo:
    ports:
      - 27017:27017

  mongo-express:
    image: mongo-express
    restart: always
    ports:
      - 8081:8081
    environment:
      ME_CONFIG_MONGODB_URL: mongodb://mongo:27017/
      ME_CONFIG_BASICAUTH: false
